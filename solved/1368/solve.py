from Crypto.Util.number import long_to_bytes, inverse

# 1. 문제에서 주어진 값들 설정
p1_hardcoded = 122925338396977892377812264658939951801210314312238212067059595148447406166769716855936119104014353481162826500622396956338370238037713303129667973570418205129792800094492802512333202767609745542480301632710243676880179931490273979269048908687034938065216226244568368994455058377505090061149006930577060428653

# RSA Set 1 Data
N1 = 19327201401631091708078119279128692380925436148753032544895352594739110282713758787694579835391781210402243077561190953131900323053423046549084383867230010218276408621326328657011461469470863807292770977339969966619084182213730972103570599543306681902985938663544751982304914890625033249271730565010591288864800205047761519021424394075419080844544837213852439849121802683213686553168522746043462188813484812435077464939031324951004504043502401170179833768423690231004598616247184121591410659261674988936191040818361630775820141493597159203856838814572719736836706893107415465623258821901349346519326330233623214728221
e = 65537
FLAG1_enc = 13004466492825661714373794815483060213694105615136425500989349693819961897670052449133543120631375577093758006042616662397161828589759021109123036143679110213645273703495254751289251984825741644206592407373383229795977571891490892303010088149447806230252355167293296067357472058390377966149510304189768318019106010038464918342981779040801334805493934402083256202515878968471566745346269521478477710514882908808895056775440776187428798107877812935170817655999121652544951651932298324706467047940709230959842386229472100688721362825588490871211182464995770751546581073841668835160521366577198069608693267099763820863798

# RSA Set 2 Data
N2 = 27450043483315478797311762404726094577043502998132803099792119462966972085300899948161891817110329463991628866797190656347290669289715965306807327781311775199098217243334803546897391127316534191753025750966088057417220995637276594988237432346097632955067112307495374843098339005553306641285945162968651827001664879318348061935910034735641200929274386097426194176189548233606952782529875735520470196679662317949279351304878856061765216511421722100868900219446793017053639756452344855640565216220821535719191238236595833273152962271929229104781027974482540785947824462470111459855576434011643733382300240759662671745043
FLAG2_enc = 17463642564205701432307028203763062907371381377693194828300595918415046220812120475428225071119982138749111622652127381786090687125183190277170778539362877193467937714016137568118933014547356440506555629558154283687808070558309970344505816619533040961898974711852132964742029858929057461119543575535330375800427250608222111417772757317328946180150624934340736646008296127968384530576375036996310505498939822504071130031960700949736356441252292463128173777657044615516176593682581668414273678552105485641336500940770941508284916043004595128850506708764616933566005759493826241800383490202557574106404650701685720400402


def decrypt_rsa(N, e, ct, known_prime):
    # 2. 알려진 소수를 이용해 다른 소수 q 구하기
    q = N // known_prime
    
    # 3. 개인키 d 계산
    phi = (known_prime - 1) * (q - 1)
    d = inverse(e, phi)
    
    # 4. 복호화
    m = pow(ct, d, N)
    return long_to_bytes(m)

# ----------------------------
# Step 1: FLAG1 복호화
# ----------------------------
print("[*] Decrypting FLAG1...")
# p1은 코드에 하드코딩 되어 있음
p1 = p1_hardcoded
flag1_bytes = decrypt_rsa(N1, e, FLAG1_enc, p1)
print(f"FLAG1 part: {flag1_bytes}")

# ----------------------------
# Step 2: FLAG2 복호화
# ----------------------------
print("\n[*] Decrypting FLAG2...")
# p2는 2*p1 + 1 임
p2 = 2 * p1 + 1
flag2_bytes = decrypt_rsa(N2, e, FLAG2_enc, p2)
print(f"FLAG2 part: {flag2_bytes}")

# ----------------------------
# Step 3: 결과 합치기
# ----------------------------
full_flag = flag1_bytes + flag2_bytes
print(f"\n[+] Full FLAG: {full_flag.decode()}")