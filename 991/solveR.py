from Crypto.Util.number import long_to_bytes, inverse

# 1. 문제에서 주어진 값들
e1 = 0x10001
e2 = 0x10111
N = 19541651418205358619802242346309047478636675591878153033367048596806480874319165570321560343830252030852555441569079653907875099374577190255435113061830293291626406312836712523866644945037105341742424605657694906602274739581389373071850402609689950585852789174958835090899380926124333232387457038274404382608447358042207037946958186392145156095551594542692431405870552218631273863177001172891191044820118590892558933309184510683564393484125553068835756763532116490202660052364335529493403975487667026029713115936303870971148737106048690770857703807329645143204197965488819112933302672431481698178136749768729244339907
c1 = 2003274469879230664598009674216278920821386720795066072791650031493944850126893665852450626262228683502568959124636937507822883004250831198469207330004031385951384691161979080969953673480079625413602403857696640362879257008659581203517064048927327443043881908293219174523981962702499112773561408640112494752938589708985546189036599687304130130697783363653526450555511629237313965265391312966522092955244506378109896667076204928291212275877934883886078757428216354926164947611182263503947817483911604052964608708434919431929973325521497156421936261786089046650977984983283915802950963440214731773312597367575958670006
c2 = 8721049175243125506726914469225100321544804852668072305241256671294607682624875549441837956089731943596494754361583991832880429869467543685805165278446162189551435715076338377601692043317153490301462055446716202786841785783599112342554833939481737619373868006225829698267368283948637576828814199397378330071862713333637351127812347111603688434513400287166369506982925151784528401997224557534533636052410890482850261778482944651182765242852116273655322284349135250144342275989549238183067842626054223482808883761280459251026940940372141970714305673437738881398891645332312094372545071254455571103585120025216431891599

# 2. 확장 유클리드 알고리즘 (egcd)
def egcd(a, b):
    if a == 0:
        return (b, 0, 1)
    else:
        g, y, x = egcd(b % a, a)
        return (g, x - (b // a) * y, y)

# 3. a * e1 + b * e2 = gcd(e1, e2) = 1 인 a, b 구하기
g, a, b = egcd(e1, e2)
print(f"gcd: {g}, a: {a}, b: {b}")

if g != 1:
    print("Error: gcd is not 1. Cannot use simple Common Modulus Attack.")
else:
    # 4. m = c1^a * c2^b (mod N) 계산
    # a나 b가 음수일 경우를 대비해 처리
    if a < 0:
        c1_part = pow(inverse(c1, N), -a, N)
    else:
        c1_part = pow(c1, a, N)
        
    if b < 0:
        c2_part = pow(inverse(c2, N), -b, N)
    else:
        c2_part = pow(c2, b, N)

    m = (c1_part * c2_part) % N
    
    # 5. 결과 출력
    try:
        flag = long_to_bytes(m)
        print("Flag:", flag.decode())
    except Exception as e:
        print("Decoded long:", m)
        print("Error decoding bytes:", e)